# vim: set filetype=sh:
# Basic functions

function update-ssh-known-hosts () {
	echo "Updating ssh known hosts from tin.eqiad.wmnet"
	scp tin.eqiad.wmnet:/etc/ssh/ssh_known_hosts ~/.ssh/known_hosts-wmf
}

# Run git with tracing
function gittrace() {
	GIT_TRACE=1 git "$@"
}

function gerrit() {
	if [ -z "$1" ]; then
		ARGS="--help"
	else
		ARGS="$@"
	fi;
	set -x
	ssh -p 29418 hashar@gerrit.wikimedia.org "gerrit $ARGS"
	set +x
}

function 720x480() {
	osascript -e "tell application \"Terminal\" to set the bounds of the first window to {100, 50, 820, 530}"
}

# Show up a pint of beer on Mac OS X :-D
# BEER MUG (U+1F37A) -- thanks Saper for the reference
function beer() {
	echo 'üç∫ ';
}

# Similar as beer() but gives out three cookies
function cookies() {
	echo 'üç™ üç™ üç™';
}

# American's loves them..
function donuts() {
	echo 'üç©';
}

function jenkins() {
	cmd=$1
	shift

	case "$cmd" in
	"validate")
		# Create a dummy change for jenkins validation
		touch JENKINS jenkins.php jenkins.js jenkins.rb jenkins.pp jenkins.erb jenkins-testfile.py \
			&& git add JENKINS jenkins.php jenkins.js jenkins.rb jenkins.pp jenkins.erb jenkins-testfile.py \
			&& git commit -m 'Jenkins job validation (DO NOT SUBMIT)' \
			&& git show \
			&& echo "Now send the change!   git-review -D"
		;;
	'help' | *)
		echo "Oh no"
		;;
	esac
}

function php-extension_dir() {
	php -r 'print ini_get("extension_dir");'
}

function php-profile() {
	php -d xdebug.profiler_enable=1 $@
}

function php-trace() {
	php -d xdebug.auto_trace=1 $@
}

function php-trace-raw() {
	php -d xdebug.auto_trace=1 -d xdebug.trace_format=1 $@
}

function php-vld() {
	php -d "extension=vld.so" -d vld.active=1 -d vld.execute=0 -f $1
}

function puppetself() {
	# FIXME bails out when not in labs
	export GIT_SSH=/var/lib/git/ssh
	echo "Changed GIT_SSH to $GIT_SSH"
	cd /var/lib/git
}

function ppv() {
	puppet parser validate $@
}

function gbp-precise() {
	DIST=precise git-buildpackage --git-builder=git-pbuilder
}
